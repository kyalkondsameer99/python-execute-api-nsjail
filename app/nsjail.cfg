# app/nsjail.cfg
# Minimal nsjail configuration for Python sandbox

name: "pyexec"
description: "Python execution jail"
mode: ONCE

# No network access
clone_newnet: true
iface_no_lo: true

# Namespaces
clone_newuser: true
clone_newns: true
clone_newipc: true
clone_newuts: true
clone_newpid: true

# Map nobody inside
uidmap { inside_id: 1000, outside_id: 65534, count: 1 }
gidmap { inside_id: 1000, outside_id: 65534, count: 1 }

# Drop capabilities
keep_caps: false

# Resource limits
rlimit_fsize: 10485760
rlimit_nofile: 128
rlimit_nproc: 128
rlimit_cpu: 10
rlimit_as: 268435456
max_cpus: 1

# Minimal devices
mount { src: "/dev/null"    dst: "/dev/null"    is_bind: true  rw: false }
mount { src: "/dev/urandom" dst: "/dev/urandom" is_bind: true  rw: false }

# Python and system libs (read-only)
mount { src: "/bin"       dst: "/bin"       is_bind: true rw: false }
mount { src: "/usr"       dst: "/usr"       is_bind: true rw: false }
mount { src: "/lib"       dst: "/lib"       is_bind: true rw: false }
mount { src: "/lib64"     dst: "/lib64"     is_bind: true rw: false }
mount { src: "/usr/local" dst: "/usr/local" is_bind: true rw: false }

# tmpfs for scratch
mount {
  dst: "/tmp"
  fstype: "tmpfs"
  rw: true
  options: "size=32M,nr_inodes=1k,mode=1777"
}

# Disable /proc for extra hardening
mount_proc: false
